<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      body {font-family:'Helvetica Neue', Arial, sans-serif; color:#333; font-size:13px; line-height:17px;}
      body .name,body .note {white-space:pre-wrap;}
      body ul {list-style:disc; margin:0; padding:0;}
      body li {margin:4px 0 4px 20px; padding:0;}
      body>.name {font-size:16px; line-height:21px;}
      body>.note {font-size:13px; line-height:17px;}
      body>ul {margin-top:15px;}
      body .name.done {text-decoration:line-through; color:#999;}
      body .note {font-size:12px; color:#666;}
    </style>
  </head>
  <body>
    <span class="name"><span class="innerContentContainer"><b>05-Debug&amp;ADB</b></span></span><ul><li><span class="name"><span class="innerContentContainer">分析问题的首选方法  <span class="contentTag" title="Filter #经验总结">#<span class="contentTagText">经验总结</span><span class="contentTagNub"></span></span> </span></span><ul><li><span class="name"><span class="innerContentContainer">USB 相关问题，首选是Bus Hound；</span></span></li><li><span class="name"><span class="innerContentContainer">硬件问题：把线连出来，上示波器。要会用示波器。</span></span></li><li><span class="name"><span class="innerContentContainer">用trace 跟无问题，不跟才有，一般和踢狗相关。</span></span></li><li><span class="name"><span class="innerContentContainer">性能问题，先要流程分解成3-6个阶段，然后通过log 打印等方式得出各阶段的时耗，找到突破点。</span></span></li><li><span class="name"><span class="innerContentContainer">功耗问题，逐个器件拔。</span></span></li><li><span class="name"><span class="innerContentContainer">迅速缩小焦点：</span></span><ul><li><span class="name"><span class="innerContentContainer">FFA上有吗? 有, 就是高通的问题. 没有,则是我们的修改引入的.</span></span></li><li><span class="name"><span class="innerContentContainer">新版本有吗? 没有, 则已经解决.</span></span></li><li><span class="name"><span class="innerContentContainer">老版本有吗? 没有, 则是最近修改引入的. 有, 则是固有问题.</span></span></li><li><span class="name"><span class="innerContentContainer">新单板有吗? 没有, 则已经解决. (软件版本一致的情况下)</span></span></li><li><span class="name"><span class="innerContentContainer">老单板有吗? 没有, 则为硬件修改引入. (软件版本一致的情况下)</span></span></li><li><span class="name"><span class="innerContentContainer">第三方应用有吗? 有, 说明是底层问题. 没有, 说明是应用的问题. (非绝对)</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">时刻关注自己是在哪个层面上考虑问题：</span></span><ul><li><span class="name"><span class="innerContentContainer">是cpu层次（包括cpu、硬件寄存器、dma）</span></span></li><li><span class="name"><span class="innerContentContainer">是外设级别（要考虑时序、电源）</span></span></li><li><span class="name"><span class="innerContentContainer">还是task级别（sig、队列、task切换、堆栈、中断等）</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">张建春的定位技巧  <span class="contentTag" title="Filter #经验总结">#<span class="contentTagText">经验总结</span><span class="contentTagNub"></span></span> </span></span><ul><li><span class="name"><span class="innerContentContainer">多看 MODEM SOFTWARE INTERFACE .pdf，学会对arm硬件寄存器的直接操作。</span></span></li><li><span class="name"><span class="innerContentContainer">下发“FALSH读”的指令：D.S SD:0X60000304 %LE %LONG 1；D.S SD:0X60000100 %LE %LONG 0x2。0X60000304&nbsp; 即 page read指令。</span></span></li><li><span class="name"><span class="innerContentContainer">设置读地址：D.S SD:0X60000300 %LE %LONG 0x0279c00；</span></span></li><li><span class="name"><span class="innerContentContainer">查看FALSH读写状态：0X60000308；</span></span></li><li><span class="name"><span class="innerContentContainer">查看ECC 纠错的位数：0X6000030C。0表示无错误；超过4个字节就无法正确纠正。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer"><b>Android有几种Log?  <span class="contentTag" title="Filter @iPanorama">@<span class="contentTagText">iPanorama</span><span class="contentTagNub"></span></span> </b></span></span><ul><li><span class="name"><span class="innerContentContainer">Android log系统框图  <span class="contentTag" title="Filter @iChart">@<span class="contentTagText">iChart</span><span class="contentTagNub"></span></span> </span></span></li><li><span class="name"><span class="innerContentContainer">模板</span></span><ul><li><span class="name"><span class="innerContentContainer">1. log名称:</span></span></li><li><span class="name"><span class="innerContentContainer">2. log层次:</span></span></li><li><span class="name"><span class="innerContentContainer">3. 常用于解决哪类问题:</span></span></li><li><span class="name"><span class="innerContentContainer">4. 是否依赖特定平台:</span></span></li><li><span class="name"><span class="innerContentContainer">5. 抓取方法:</span></span></li><li><span class="name"><span class="innerContentContainer">6. log文件名:</span></span></li><li><span class="name"><span class="innerContentContainer">7. 查看工具:</span></span></li><li><span class="name"><span class="innerContentContainer">8. log内容:</span></span></li><li><span class="name"><span class="innerContentContainer">9. 核心log是什么，一般的分析方法是什么:</span></span></li><li><span class="name"><span class="innerContentContainer">10. log打印的原理:</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer"><b>logcat</b></span></span><ul><li><span class="name"><span class="innerContentContainer">1. log名称: logcat</span></span></li><li><span class="name"><span class="innerContentContainer">2. log层次: 包括4种log, 应用log, fwk log, 射频通话log (暂不关注), 系统事件log(单列)</span></span></li><li><span class="name"><span class="innerContentContainer">3. 常用于解决哪类问题: 分析应用和fwk层的所有问题.</span></span></li><li><span class="name"><span class="innerContentContainer">4. 是否依赖特定平台: 原生, 不依赖.</span></span></li><li><span class="name"><span class="innerContentContainer">5. 抓取方法: adb logcat *** .   参数如下:</span></span><ul><li><span class="name"><span class="innerContentContainer"><b>-b main</b></span></span><ul><li><span class="name"><span class="innerContentContainer">默认, 主程序log. </span></span></li><li><span class="name"><span class="innerContentContainer">一般用户空间log将写入设备节点 /dev/log/main，包括 System.out.print 及 System.erro.print 等.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">-b system</span></span><ul><li><span class="name"><span class="innerContentContainer">fwk层log信息和debugging.</span></span></li><li><span class="name"><span class="innerContentContainer">为了防止mian缓存区溢出, 而从其中分离出来.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">-b radio</span></span><ul><li><span class="name"><span class="innerContentContainer">射频通话相关信息.</span></span></li><li><span class="name"><span class="innerContentContainer">tag 为"HTC_RIL" "RILJ" "RILC" "RILD" "RIL" "AT" "GSM" "STK"的log信息将写入此节点.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">-v: 指定Log前缀格式, 包括:</span></span><ul><li><span class="name"><span class="innerContentContainer">brief: 默认</span></span></li><li><span class="name"><span class="innerContentContainer">process: 只有PID.</span></span></li><li><span class="name"><span class="innerContentContainer">tag: 只有优先级和PID</span></span></li><li><span class="name"><span class="innerContentContainer">time: 有日期时间, 优先级, 标签和PID</span></span></li><li><span class="name"><span class="innerContentContainer">threadtime: 仅time + thread id</span></span></li><li><span class="name"><span class="innerContentContainer">raw: 不显示前缀</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">-c: 清除log缓存</span></span></li><li><span class="name"><span class="innerContentContainer">-d: 打印当前log后退出.</span></span></li><li><span class="name"><span class="innerContentContainer">-g: 打印缓冲区大小</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">6. log文件名:  自定义</span></span></li><li><span class="name"><span class="innerContentContainer">7. 查看工具: 普通文本编辑器即可. 比如 Sublime, notepad++</span></span></li><li><span class="name"><span class="innerContentContainer">8. log内容: </span></span><ul><li><span class="name"><span class="innerContentContainer">•Logcat是一行一行的, 单条log不能跨行(其实也可以, 但是一般不建议这么做). </span></span></li><li><span class="name"><span class="innerContentContainer">每行log包括如下6个部分:</span></span><ul><li><span class="name"><span class="innerContentContainer">Tag</span></span></li><li><span class="name"><span class="innerContentContainer">时间戳</span></span></li><li><span class="name"><span class="innerContentContainer">PID, 进程ID</span></span></li><li><span class="name"><span class="innerContentContainer">TID, 线程ID</span></span></li><li><span class="name"><span class="innerContentContainer">log level</span></span></li><li><span class="name"><span class="innerContentContainer">log信息(代码中写入)</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">9. 核心log是什么，一般的分析方法是什么: 无特定方法, 一行行的看就完了.</span></span></li><li><span class="name"><span class="innerContentContainer">10. log打印的原理:</span></span><ul><li><span class="name"><span class="innerContentContainer">App通过导入android.util.Log包来引入Log类，然后通过log方法写不同优先级的相关信息到log。</span></span></li><li><span class="name"><span class="innerContentContainer">代码在: frameworks/base/core/java/android/util/Log.java</span></span></li><li><span class="name"><span class="innerContentContainer">主要方法有：</span></span><ul><li><span class="name"><span class="innerContentContainer">Log.v();</span></span></li><li><span class="name"><span class="innerContentContainer">Log.d();</span></span></li><li><span class="name"><span class="innerContentContainer">Log.i();</span></span></li><li><span class="name"><span class="innerContentContainer">Log.w();</span></span></li><li><span class="name"><span class="innerContentContainer">Log.e();</span></span></li><li><span class="name"><span class="innerContentContainer">Log.a();</span></span></li><li><span class="name"><span class="innerContentContainer">分别对应log级别：Assert，ERROR，WARN，INFO，DEBUG，VERBOSE。</span></span></li><li><span class="name"><span class="innerContentContainer">VERBOSE除了开发期间，是不应该被编译进APP的，DEBUG应该编译但在runtime被忽略，ERROR，WARN和INFO logs则一直被保留。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">jni层: frameworks/base/core/jni/android_util_Log.cpp, 关键函数是 android_util_Log_println_native()</span></span></li><li><span class="name"><span class="innerContentContainer">Native层: system/core/logcat/logcat.cpp. </span></span></li><li><span class="name"><span class="innerContentContainer">Native层打印log的方法:</span></span><ul><li><span class="name"><span class="innerContentContainer">包含system/core/include/cutils/log.h</span></span></li><li><span class="name"><span class="innerContentContainer">在模块Android.mk中添加：LOCAL_SHARED_LIBRARIES := liblog libcutils</span></span></li><li><span class="name"><span class="innerContentContainer">打印接口是: </span></span></li><li><span class="name"><span class="innerContentContainer">ALOGV</span></span></li><li><span class="name"><span class="innerContentContainer">ALOGD</span></span></li><li><span class="name"><span class="innerContentContainer">ALOGI</span></span></li><li><span class="name"><span class="innerContentContainer">ALOGW</span></span></li><li><span class="name"><span class="innerContentContainer">ALOGE</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">logd 服务: 在开机过程中被init进程启动. </span></span><ul><li><span class="name"><span class="innerContentContainer">代码在 system/core/logd</span></span></li><li><span class="name"><span class="innerContentContainer">system\core\logd\CommandListener.cpp</span></span></li><li><span class="name"><span class="innerContentContainer">system\core\logd\LogBuffer.cpp</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">底层: logging的kernel driver部分被称作”logger”</span></span><ul><li><span class="name"><span class="innerContentContainer">代码在 kernel/drivers/staging/android/logger.c</span></span></li><li><span class="name"><span class="innerContentContainer">生成4个设备节点:</span></span><ul><li><span class="name"><span class="innerContentContainer">/dev/log/main</span></span></li><li><span class="name"><span class="innerContentContainer">/dev/log/events</span></span></li><li><span class="name"><span class="innerContentContainer">/dev/log/radio</span></span></li><li><span class="name"><span class="innerContentContainer">/dev/log/system</span></span></li></ul></li></ul></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer"><b>logcat -b </b>events</span></span><ul><li><span class="name"><span class="innerContentContainer">系统事件log.</span></span></li><li><span class="name"><span class="innerContentContainer">Event logs是在 android.util.EventLog.class 中创建二进制log信息。Log条目由二进制tag代码和二进制参数构成。</span></span></li><li><span class="name"><span class="innerContentContainer">Event logs 文件存储在system/etc/event-log-tags中，通过cat system/etc/event-log-tags能查看其信息。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">kernel log</span></span><ul><li><span class="name"><span class="innerContentContainer">1. log名称: kernel log</span></span></li><li><span class="name"><span class="innerContentContainer">2. log层次: kernel</span></span></li><li><span class="name"><span class="innerContentContainer">3. 常用于解决哪类问题: 底层所有问题.</span></span></li><li><span class="name"><span class="innerContentContainer">4. 是否依赖特定平台: 不依赖</span></span></li><li><span class="name"><span class="innerContentContainer">5. 抓取方法:</span></span><ul><li><span class="name"><span class="innerContentContainer">adb shell cat /proc/kmsg；kernel日志,每cat一次会清零</span></span></li><li><span class="name"><span class="innerContentContainer">adb dmesg -n 8，配置打印级别, 8是所有都打。</span></span></li><li><span class="name"><span class="innerContentContainer">adb shell dmesg: ernel日志,开机信息.(通过var/log/demsg)</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">6. log文件名: 自定义</span></span></li><li><span class="name"><span class="innerContentContainer">7. 查看工具: 普通文本编辑器即可. 比如 Sublime, notepad++</span></span></li><li><span class="name"><span class="innerContentContainer">8. log内容: </span></span><ul><li><span class="name"><span class="innerContentContainer">较简单: 2754 2754 I binder_sample: [android.app.IActivityManager,35,2900,android.process.media,5]</span></span></li><li><span class="name"><span class="innerContentContainer">分别是 进程ID, 线程ID, 级别, Log内容</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">9. 核心log是什么，一般的分析方法是什么: 无</span></span></li><li><span class="name"><span class="innerContentContainer">10. log打印的原理:</span></span><ul><li><span class="name"><span class="innerContentContainer">使用 printk()函数 进行Log输出。</span></span></li><li><span class="name"><span class="innerContentContainer">日志级别</span></span><ul><li><span class="name"><span class="innerContentContainer">kernel log日志级别在 include/linux/kern_levels.h 定义. 字符串表示为一个尖括号中的整数，0-7，值越小优先级越高。</span></span></li><li><span class="name"><span class="innerContentContainer">优先级小于 console_loglevel 这个整数变量的消息才会打印。</span></span></li><li><span class="name"><span class="innerContentContainer">获取当前日志级别: cat /system/sys/kernel/printk, 有4个数字，第一个表示当前日志级别。</span></span></li><li><span class="name"><span class="innerContentContainer">刷新系统日志级别: echo 8 &gt; /system/sys/kernel/printk</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">换行符，log行尾一定要加换行符。否则不会输出到控制台。</span></span></li><li><span class="name"><span class="innerContentContainer">如果系统运行了 klogd 和 syslogd，则所有内核消息都会被追加到 /var/log/messages 中。</span></span></li><li><span class="name"><span class="innerContentContainer">Log buffer 大小是写在代码中的，这个宏:LOG_BUF_SHIFT，所在文件为 /kernel/init/Kconfig。</span></span></li><li><span class="name"><span class="innerContentContainer">打印速度: printk_ratelimit().</span></span></li><li><span class="name"><span class="innerContentContainer">打印主次设备号: print_dev_t(), format_dev_t().</span></span></li><li><span class="name"><span class="innerContentContainer">例子:</span></span><ul><li><span class="name"><span class="innerContentContainer">printk(KERN_ALERT "This is the log printed by printk in linux kernel space.");</span></span></li><li><span class="name"><span class="innerContentContainer">printk(KERN_ERR "%s: Invalid parameter\n", __func__);</span></span></li></ul></li><li><span class="name"></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">binder log</span></span><ul><li><span class="name"><span class="innerContentContainer">和应用层相关的binder问题主要有两类:</span></span><ul><li><span class="name"><span class="innerContentContainer">主线程被Binder 对端block导致anr;</span></span></li><li><span class="name"><span class="innerContentContainer">Binder被占满, 导致主线程无法启动binder引起异常.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer"><b>binder_sample</b>: binder通讯过程超过门限(默认500毫秒)时打印:</span></span><ul><li><span class="name"><span class="innerContentContainer">binder_sample: [android.app.IActivityManager,13,940,com.starbucks.cn,100]</span></span></li><li><span class="name"><span class="innerContentContainer">其中:</span></span><ul><li><span class="name"><span class="innerContentContainer">android.app.IActivityManager: 被调用方</span></span></li><li><span class="name"><span class="innerContentContainer">13: 方法的序号</span></span></li><li><span class="name"><span class="innerContentContainer">940: delay的时长(单位: 毫秒)</span></span></li><li><span class="name"><span class="innerContentContainer">com.starbucks.cn: 调用方</span></span></li><li><span class="name"><span class="innerContentContainer">100: 被卡住的百分比.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">相关代码在: android_util_Binder.cpp, conditionally_log_binder_call()</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">binder thread: binder线程池耗尽, 且持续时间超过门限时打印</span></span><ul><li><span class="name"><span class="innerContentContainer">binder thread&nbsp;pool (16&nbsp;threads) starved for 100 ms</span></span></li><li><span class="name"><span class="innerContentContainer">含义是: 线程池已满的持续长达100ms</span></span></li><li><span class="name"><span class="innerContentContainer">还有一个binder资源耗尽的log , binder_alloc_buf, no vma</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">BINDER FAILED TRANSACTION LOG</span></span><ul><li><span class="name"><span class="innerContentContainer">获取该log:读取文件/proc/binder/failed_transaction_log</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">BINDER TRANSACTION LOG</span></span><ul><li><span class="name"><span class="innerContentContainer">获取该log:读取文件/proc/binder/transaction_log</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">BINDER TRANSACTIONS</span></span><ul><li><span class="name"><span class="innerContentContainer">获取该log:读取文件/proc/binder/transactions</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">BINDER STATS</span></span><ul><li><span class="name"><span class="innerContentContainer">获取该log:读取文件/proc/binder/stats</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">BINDER PROCESS STATE</span></span><ul><li><span class="name"><span class="innerContentContainer">获取该log:读取文件/proc/binder/proc/*</span></span></li><li><span class="name"><span class="innerContentContainer">bind相关的一些状态</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">bugreport</span></span><ul><li><span class="name"><span class="innerContentContainer">抓取方法: adb bugreport &gt; bugreport.log</span></span></li><li><span class="name"><span class="innerContentContainer">包含有dmesg，dumpstate和dumpsys.</span></span></li><li><span class="name"><span class="innerContentContainer">可单独抓取这3种log: </span></span><ul><li><span class="name"><span class="innerContentContainer">dmesg</span></span><ul><li><span class="name"><span class="innerContentContainer">adb shell dmesg &gt; ldmesg_kernel.log</span></span></li><li><span class="name"><span class="innerContentContainer">kernel log</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">dumpstate</span></span><ul><li><span class="name"><span class="innerContentContainer">系统状态信息，里面比较全</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">dumpsys</span></span><ul><li><span class="name"><span class="innerContentContainer">系统所有进程Process的基本属性.</span></span></li></ul></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">systrace</span></span></li><li><span class="name"><span class="innerContentContainer">hprof</span></span></li><li><span class="name"><span class="innerContentContainer">anr</span></span></li><li><span class="name"><span class="innerContentContainer">traces</span></span></li><li><span class="name"><span class="innerContentContainer">tombstones</span></span></li><li><span class="name"><span class="innerContentContainer">traceView</span></span></li><li><span class="name"><span class="innerContentContainer">过度绘制</span></span></li><li><span class="name"><span class="innerContentContainer">包列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取package状态: adb shell dumpsys package, 可指定包名</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">窗口列表</span></span><ul><li><span class="name"><span class="innerContentContainer">adb shell dumpsys&nbsp;window</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">activity列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取Activity信息: adb shell dumpsys activity activities</span></span></li><li><span class="name"><span class="innerContentContainer">获取当前界面的Activity信息：adb shell dumpsys activity top</span></span></li><li><span class="name"><span class="innerContentContainer">要获取当前界面的Activity：adb shell dumpsys activity top | findstr ACTIVITY</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">服务列表</span></span><ul><li><span class="name"><span class="innerContentContainer">打印当前系统所有service信息: adb shell dumpsys activity services</span></span></li><li><span class="name"><span class="innerContentContainer">打印指定服务的信息: adb shell dumpsys service ***(指定服务名)</span></span></li><li><span class="name"><span class="innerContentContainer">列出当前运行的服务： adb shell dumpsys | findstr DUMP</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">Provider列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取provider状态:  adb shell dumpsys activity providers</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">通知列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取通知状态: adb shell dumpsys notification. 返回值是:</span></span><ul><li><span class="name"><span class="innerContentContainer">NotificationRecord(0x44217920: pkg=com.sohu.newsclient useron=0x7f0201b5 / com.tencent.news:drawable/icon</span></span></li><li><span class="name"><span class="innerContentContainer">pri=0 score=0</span></span></li><li><span class="name"><span class="innerContentContainer">contentIntent=PendingIntent{4294d748: PendingIntentRecord{44088e90 com.tencent.news startActivity}}</span></span></li><li><span class="name"><span class="innerContentContainer">deleteIntent=null</span></span></li><li><span class="name"><span class="innerContentContainer">tickerText=null</span></span></li><li><span class="name"><span class="innerContentContainer">contentView=android.widget.RemoteViews@441fc810</span></span></li><li><span class="name"><span class="innerContentContainer">defaults=0x00000001 flags=0x00000010</span></span></li><li><span class="name"><span class="innerContentContainer">sound=null</span></span></li><li><span class="name"><span class="innerContentContainer">vibrate=null</span></span></li><li><span class="name"><span class="innerContentContainer">led=0x00000000 onMs=0 offMs=0</span></span></li><li><span class="name"><span class="innerContentContainer">extras={</span></span><ul><li><span class="name"><span class="innerContentContainer">android.title=农业部:中国超级稻亩产超1吨</span></span></li><li><span class="name"><span class="innerContentContainer">android.subText=null</span></span></li><li><span class="name"><span class="innerContentContainer">android.showChronometer=false</span></span></li><li><span class="name"><span class="innerContentContainer">android.icon=2130837941</span></span></li><li><span class="name"><span class="innerContentContainer">android.text=农业部今日通报称,经专家测产,袁隆平领衔培育的中国“超级稻”亩产过千公斤,创造1026.7公斤新纪录。详情&gt;&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">android.progress=0</span></span></li><li><span class="name"><span class="innerContentContainer">android.progressMax=0</span></span></li><li><span class="name"><span class="innerContentContainer">android.showWhen=true</span></span></li><li><span class="name"><span class="innerContentContainer">android.infoText=null</span></span></li><li><span class="name"><span class="innerContentContainer">android.progressIndeterminate=false</span></span></li><li><span class="name"><span class="innerContentContainer">android.scoreModified=false</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">}</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">广播列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取广播: adb shell dumpsys activity broadcasts</span></span></li><li><span class="name"><span class="innerContentContainer">获取intents消息: adb shell dumpsys activity intents</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">进程列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取进程状态: adb shell dumpsys activity processes</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">提醒列表</span></span><ul><li><span class="name"><span class="innerContentContainer">获取提醒状态: adb shell dumpsys alarm</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">内存状态</span></span><ul><li><span class="name"><span class="innerContentContainer">获取内存状态:  adb shell dumpsys meminfo</span></span></li><li><span class="name"><span class="innerContentContainer">要获取具体应用的内存信息，可加上包名:  adb shell dumpsys meminfo PACKAGE_NAME</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">各种设备管理</span></span><ul><li><span class="name"><span class="innerContentContainer">获取屏幕状态:  adb shell dumpsys display | findstr DisplayDeviceInfo.  返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">DisplayDeviceInfo{"内置屏幕": 1080 x 1920, 55.0 fps, density 480, 464.949 x 468.923 dpi...</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取设备电池状态: adb shell dumpsys battery / batterystats. 返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">Current Battery Service state:</span></span></li><li><span class="name"><span class="innerContentContainer">AC powered: false</span></span></li><li><span class="name"><span class="innerContentContainer">USB powered: true</span></span></li><li><span class="name"><span class="innerContentContainer">Wireless powered: false</span></span></li><li><span class="name"><span class="innerContentContainer">status: 2   # 电池状态</span></span></li><li><span class="name"><span class="innerContentContainer">health: 2</span></span></li><li><span class="name"><span class="innerContentContainer">present: true</span></span></li><li><span class="name"><span class="innerContentContainer">level: 34  # 电量</span></span></li><li><span class="name"><span class="innerContentContainer">scale: 100</span></span></li><li><span class="name"><span class="innerContentContainer">voltage: 3848</span></span></li><li><span class="name"><span class="innerContentContainer">current now: -427943</span></span></li><li><span class="name"><span class="innerContentContainer">temperature: 280   # 电池温度</span></span></li><li><span class="name"><span class="innerContentContainer">technology: Li-ion</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">查看camera属性和状态: adb shell dumpsys media.camera</span></span><ul><li><span class="name"><span class="innerContentContainer">注意 stream[0], [1]</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取wifi状态: adb shell dumpsys wifi. 可以获取到当前连接的wifi名、搜索到的wifi列表、wifi强度等</span></span></li><li><span class="name"><span class="innerContentContainer">获取电源管理状态: adb shell dumpsys power. 返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">可以获取到是否处于锁屏状态：mWakefulness=Asleep或者mScreenOn=false</span></span></li><li><span class="name"><span class="innerContentContainer">亮度值：mScreenBrightness=255</span></span></li><li><span class="name"><span class="innerContentContainer">屏幕休眠时间：Screen off timeout: 60000 ms</span></span></li><li><span class="name"><span class="innerContentContainer">屏幕分辨率：mDisplayWidth=1440，mDisplayHeight=2560</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取位置状态: adb shell dumpsys location</span></span></li><li><span class="name"><span class="innerContentContainer">获取电话状态: adb shell dumpsys telephony.registry. 返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">mCallState值为0，表示待机状态、1表示来电未接听状态、2表示电话占线状态</span></span></li><li><span class="name"><span class="innerContentContainer">mCallForwarding=false   # 是否启用呼叫转移</span></span></li><li><span class="name"><span class="innerContentContainer">mDataConnectionState=2 #0：无数据连接 1：正在创建数据连接 2：已连接</span></span></li><li><span class="name"><span class="innerContentContainer">mDataConnectionPossible=true   # 是否有数据连接</span></span></li><li><span class="name"><span class="innerContentContainer">mDataConnectionApn=   # APN名称</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取CPU信息:  adb shell dumpsys cpuinfo</span></span></li><li><span class="name"><span class="innerContentContainer">获取账号状态: adb shell dumpsys account</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">Input事件列表</span></span></li><li><span class="name"><span class="innerContentContainer">tcpdump</span></span><ul><li><span class="name"><span class="innerContentContainer">TCP/IP协议相关的log</span></span></li><li><span class="name"><span class="innerContentContainer">adb shell tcpdump -s 10000 -w /sdcard/capture.pcap</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">常见LOG关键字  ***</span></span><ul><li><span class="name"><span class="innerContentContainer">系统重启： beginning of main|beginning of system </span></span></li><li><span class="name"><span class="innerContentContainer">crash开始： beginning of crash</span></span></li><li><span class="name"><span class="innerContentContainer">系统进入桌面： system now ready</span></span></li><li><span class="name"><span class="innerContentContainer">一级crash： crash|fatal|backtrace|died|watchdog|goodbye|shutting down vm|Androidruntime| am_crash|am_kill|service crashed|java.lang.runtimeexception|exit zygote</span></span></li><li><span class="name"><span class="innerContentContainer">二级crash：Err|fail|unexpected|system.err|java.lang|Systrace</span></span></li><li><span class="name"><span class="innerContentContainer">卡死冻屏: held by|blocked|caused by|locked|waiting on|locked</span></span></li><li><span class="name"><span class="innerContentContainer">ANR： ANR in|Input event dispatching timed out</span></span></li><li><span class="name"><span class="innerContentContainer">input 子系统： Inputreader|inputdispatcher|eventhub|inputmanager_dispatch</span></span></li><li><span class="name"><span class="innerContentContainer">接收广播： received broadcast|onReceive， 太多，建议直接搜广播名</span></span></li><li><span class="name"><span class="innerContentContainer">Usb对话框： showMtpDialog : mode</span></span></li><li><span class="name"><span class="innerContentContainer">Log溢出： identical</span></span></li><li><span class="name"><span class="innerContentContainer">binder溢出： binder_alloc_buf, no vma</span></span></li><li><span class="name"><span class="innerContentContainer">丢帧： Choreographer: Skipped</span></span></li><li><span class="name"><span class="innerContentContainer">垃圾回收： Starting a blocking GC Alloc|GC freed</span></span></li><li><span class="name"><span class="innerContentContainer">CPU占用率： CPU usage</span></span></li><li><span class="name"><span class="innerContentContainer">应用启动： Start proc|New app record|Displayed</span></span></li><li><span class="name"><span class="innerContentContainer">焦点窗口切换： Set focused app to</span></span></li><li><span class="name"><span class="innerContentContainer">进程名</span></span></li><li><span class="name"><span class="innerContentContainer">进程ID</span></span></li><li><span class="name"><span class="innerContentContainer">数据库更新： onSharedPreferenceChanged</span></span></li><li><span class="name"><span class="innerContentContainer">处理事件： handleMessage, what</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">常见ADB命令</span></span><ul><li><span class="name"><span class="innerContentContainer">加view边框： adb shell setprop debug.layout true    ****</span></span></li><li><span class="name"><span class="innerContentContainer">Monkey：adb shell monkey -v -p &lt;apk&gt; 50000   ***</span></span></li><li><span class="name"><span class="innerContentContainer">截图：  adb shell screencap -p /sdcard/DMIC/     ***</span></span></li><li><span class="name"><span class="innerContentContainer">修改prop项（重启后失效）： adb shell setporp</span></span></li><li><span class="name"><span class="innerContentContainer">修改prop项（重启不失效）： pull 到本地，用写字板修改，然后再push回去，改权限644，最后重启。</span></span></li><li><span class="name"><span class="innerContentContainer">过滤Log关键字: adb logcat | findstr "***"</span></span><ul><li><span class="name"><span class="innerContentContainer">过滤多个关键字: findstr 后用空格分开.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">logcat 遇到 read: unexpected EOF!. 解决办法是:</span></span><ul><li><span class="name"><span class="innerContentContainer">adb logcat -G 2m</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer"><b>模拟按键事件</b>:  adb shell input keyevent KEYCODE_HOME</span></span><ul><li><span class="name"><span class="innerContentContainer">事件在 KeyEvent.java 中定义.</span></span></li><li><span class="name"><span class="innerContentContainer">比如： public static final int KEYCODE_HOME = 3;</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">模拟触摸事件:  adb shell input tap 500 500</span></span></li><li><span class="name"><span class="innerContentContainer">模拟滑动事件:  adb shell input swipe 900 500 100 500</span></span></li><li><span class="name"><span class="innerContentContainer">模拟长按事件: adb shell input swipe 500 500 501 501 2000</span></span></li><li><span class="name"><span class="innerContentContainer">截图命令:  adb shell screencap -p /sdcard/screen.png</span></span></li><li><span class="name"><span class="innerContentContainer">新增的录制命令:  adb shell screenrecord sdcard/record.mp4</span></span></li><li><span class="name"><span class="innerContentContainer">发送文本内容(不能发中文):  adb shell input text test123456</span></span></li><li><span class="name"><span class="innerContentContainer">settings 命令</span></span><ul><li><span class="name"><span class="innerContentContainer">setings 命令的key值在 android.provider.Settings 中定义。</span></span></li><li><span class="name"><span class="innerContentContainer">获取、修改wifi状态（wifi_on）、飞行模式（airlpane_mode_on）等，这里也是appium中 getNetworkConnection获得设备网络状态的方法。</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">其它ADB命令</span></span><ul><li><span class="name"><span class="innerContentContainer">ADB连接管理</span></span><ul><li><span class="name"><span class="innerContentContainer">等待设备连接上: adb wait-for-device  --用于脚本，***</span></span></li><li><span class="name"><span class="innerContentContainer">查看连接中的设备：adb devices.  返回设备ID可用于其它命令.</span></span></li><li><span class="name"><span class="innerContentContainer">指定设备安装: adb  -s [设备ID] install ...</span></span></li><li><span class="name"><span class="innerContentContainer">获取设备序列号：adb get-serialno</span></span></li><li><span class="name"><span class="innerContentContainer">获取设备状态: adb get-state </span></span><ul><li><span class="name"><span class="innerContentContainer">设备的状态有 3 钟，device&nbsp;,&nbsp;offline&nbsp;,&nbsp;unknown</span></span></li><li><span class="name"><span class="innerContentContainer">device：设备正常连接</span></span></li><li><span class="name"><span class="innerContentContainer">offline：连接出现异常，设备无响应</span></span></li><li><span class="name"><span class="innerContentContainer">unknown：没有连接设备</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">终止adb服务进程：adb kill-server</span></span></li><li><span class="name"><span class="innerContentContainer">重启adb服务进程：adb start-server</span></span></li><li><span class="name"><span class="innerContentContainer">查看ADB帮助：adb help</span></span></li><li><span class="name"><span class="innerContentContainer">将宿主机上的某个端口重定向到设备的某个端口:  db forward tcp:1314 tcp:8888</span></span></li><li><span class="name"><span class="innerContentContainer">无线连接 Android 设备</span></span><ul><li><span class="name"><span class="innerContentContainer">手机、PC处于相同的网络下，手机 root ，安装应用 adbWireless ，启动应用后点击界面中间的按钮</span></span></li><li><span class="name"><span class="innerContentContainer">运行 adb connect 192.168.1.102&nbsp;, 即可通过无线的方式连接手机，缺点是速度比较慢</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">重启机器：adb reboot</span></span></li><li><span class="name"><span class="innerContentContainer">重启到bootloader，即刷机模式：adb reboot bootloader</span></span></li><li><span class="name"><span class="innerContentContainer">重启到recovery，即恢复模式：adb reboot recovery</span></span></li><li><span class="name"><span class="innerContentContainer">重启到EDL模式(快速刷机): adb reboot edl</span></span><ul><li><span class="name"><span class="innerContentContainer">在fastboot 中也可以进 EDL: fastboot oem edl</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">设备管理</span></span><ul><li><span class="name"><span class="innerContentContainer">关闭屏幕： adb shell input keyevent 26</span></span></li><li><span class="name"><span class="innerContentContainer">获取prop值:  adb shell getprop ro.build.version.sdk</span></span></li><li><span class="name"><span class="innerContentContainer">获取设备分辨率:  adb shell wm size</span></span><ul><li><span class="name"><span class="innerContentContainer">Physical size: 1080x1920</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取MAC地址：adb shell cat /sys/class/net/wlan0/address</span></span></li><li><span class="name"><span class="innerContentContainer">获取CPU序列号：adb shell cat /proc/cpuinfo</span></span></li><li><span class="name"><span class="innerContentContainer">查看wifi密码：adb shell cat /data/misc/wifi/*.conf</span></span></li><li><span class="name"><span class="innerContentContainer">获取设备名称：adb shell cat /system/build.prop</span></span></li><li><span class="name"><span class="innerContentContainer">获取亮度是否为自动获取: adb shell settings get system screen_brightness_mode</span></span></li><li><span class="name"><span class="innerContentContainer">获取当前亮度值: adb shell settings get system screen_brightness</span></span></li><li><span class="name"><span class="innerContentContainer">更改亮度值（亮度值在0—255之间）: adb shell settings put system screen_brightness 150</span></span></li><li><span class="name"><span class="innerContentContainer">获取屏幕休眠时间: adb shell settings get system screen_off_timeout</span></span></li><li><span class="name"><span class="innerContentContainer">更改休眠时间，10分钟: adb shell settings put system screen_off_timeout 600000</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">内存管理</span></span><ul><li><span class="name"><span class="innerContentContainer">查看设备cpu和内存占用情况：adb shell top</span></span></li><li><span class="name"><span class="innerContentContainer">查看占用内存前6的app：adb shell top -m 6</span></span></li><li><span class="name"><span class="innerContentContainer">刷新一次内存信息，然后返回：adb shell top -n 1</span></span></li><li><span class="name"><span class="innerContentContainer">查询各进程内存使用情况：adb shell procrank</span></span></li><li><span class="name"><span class="innerContentContainer">查看当前内存占用：adb shell cat /proc/meminfo</span></span></li><li><span class="name"><span class="innerContentContainer">查看IO内存分区：adb shell cat /proc/iomem</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">分区和文件管理</span></span><ul><li><span class="name"><span class="innerContentContainer">将system分区重新挂载为可读写分区：adb remount</span></span></li><li><span class="name"><span class="innerContentContainer">从本地复制文件到设备：adb push &lt;local&gt; &lt;remote&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">从设备复制文件到本地：adb pull &lt;remote&gt;&nbsp; &lt;local&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">查看文件内容：adb shell cat &lt;file&gt;</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">进程管理</span></span><ul><li><span class="name"><span class="innerContentContainer">查看进程列表：adb shell ps</span></span></li><li><span class="name"><span class="innerContentContainer">获取指定进程号： adb shell "ps | grep camera"</span></span></li><li><span class="name"><span class="innerContentContainer">查看指定进程状态：adb shell ps -x [PID]</span></span></li><li><span class="name"><span class="innerContentContainer">杀死一个进程：adb shell kill [pid]</span></span></li><li><span class="name"><span class="innerContentContainer">获取线程数的上限: adb shell cat /proc/sys/kernel/threads_max</span></span><ul><li><span class="name"><span class="innerContentContainer">FindX 是 57798</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取同时打开文件数上限: adb shell cat /proc/sys/fs/file_max</span></span><ul><li><span class="name"><span class="innerContentContainer">FindX 是732094</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">关闭 java 虚拟机: adb shell stop</span></span></li><li><span class="name"><span class="innerContentContainer">打开 java 虚拟机: adb shell start</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">APK管理</span></span><ul><li><span class="name"><span class="innerContentContainer">安装APK：adb install &lt;apkfile&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">Q版本上安装APK：adb install -t &lt;apkfile&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">重新安装apk(保留数据和缓存)：adb install -r &lt;apkfile&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">安装apk到sd卡：adb install -s &lt;apkfile&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">卸载APK：adb uninstall &lt;package&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">卸载app但保留数据和缓存文件：adb uninstall -k &lt;package&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">获取apk的packagename 和 classname:  aapt d badging &lt;apkfile&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">列出安装在设备上的应用:  adb shell pm list package</span></span></li><li><span class="name"><span class="innerContentContainer">列出系统应用: adb shell pm list package -s</span></span></li><li><span class="name"><span class="innerContentContainer">列出第三方应用:  adb shell pm list package -3</span></span></li><li><span class="name"><span class="innerContentContainer">列出应用包名及对应的apk名及存放位置: adb shell pm list package -f</span></span></li><li><span class="name"><span class="innerContentContainer">列出应用包名及其安装来源:   adb shell pm list package -f -3 -i zhihu</span></span><ul><li><span class="name"><span class="innerContentContainer">返回: package:/data/app/com.zhihu.android-1.apk=com.zhihu.android  installer=com.xiaomi.market</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">列出对应包名的 .apk 位置: adb shell pm path com.tencent.mobileqq</span></span></li><li><span class="name"><span class="innerContentContainer">列出指定应用的 dump 信息: adb shell pm dump com.tencent.mobileqq</span></span></li><li><span class="name"><span class="innerContentContainer">安装应用(apk 文件在Android 设备中): pm install</span></span></li><li><span class="name"><span class="innerContentContainer">清除应用数据:  pm clear</span></span></li><li><span class="name"><span class="innerContentContainer">设置和获取应用安装位置: pm get-install-location</span></span><ul><li><span class="name"><span class="innerContentContainer">[0/auto]：默认为自动</span></span></li><li><span class="name"><span class="innerContentContainer">[1/internal]：默认为安装在手机内部</span></span></li><li><span class="name"><span class="innerContentContainer">[2/external]：默认安装在外部存储</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">Activity和service管理</span></span><ul><li><span class="name"><span class="innerContentContainer">启动应用：adb shell am start -n &lt;package_name&gt;/.&lt;activity_class_name&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">启动一个 Activity: adb shell am start -n com.android.camera/.Camera</span></span></li><li><span class="name"><span class="innerContentContainer">先停止再启动:  adb shell am start -S com.android.camera/.Camera</span></span></li><li><span class="name"><span class="innerContentContainer">等待应用完成启动: adb shell am start -W com.android.camera/.Camera</span></span></li><li><span class="name"><span class="innerContentContainer">结束应用: am force-stop com.android.camera/.Camera</span></span></li><li><span class="name"><span class="innerContentContainer">获取当前界面的控件信息: adb shell uiautomator dump. 返回: </span></span><ul><li><span class="name"><span class="innerContentContainer">UI hierchary dumped to: /storage/emulated/legacy/window_dump.xml</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">列举所有services：adb shell service list</span></span></li><li><span class="name"><span class="innerContentContainer">启动一个服务: am startservice</span></span></li><li><span class="name"><span class="innerContentContainer">发送一个广播: am broadcast</span></span></li><li><span class="name"><span class="innerContentContainer">监控 crash 与 ANR:  am monitor </span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">输入法和本地化</span></span><ul><li><span class="name"><span class="innerContentContainer">列出输入法: adb shell ime list -s, 返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">com.google.android.inputmethod.pinyin/.PinyinIME</span></span></li><li><span class="name"><span class="innerContentContainer">com.baidu.input_mi/.ImeService</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取系统默认输入法: adb shell settings get secure default_input_method, 返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">com.sohu.inputmethod.sogouoem/.SogouIME  默认搜狗输入法</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">选择输入法:  adb shell ime set com.baidu.input_mi/.ImeService</span></span></li><li><span class="name"><span class="innerContentContainer">默认为Appium使用中文输入时安装的输入法</span></span><ul><li><span class="name"><span class="innerContentContainer">adb shell settings get secure default_input_method io.appium.android.ime/.UnicodeIME</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">put命令更改默认输入法（将io.appium.android.ime/.UnicodeIME改为com.sohu.inputmethod.sogouoem/.SogouIME）</span></span><ul><li><span class="name"><span class="innerContentContainer">adb shell settings put secure default_input_method com.sohu.inputmethod.sogouoem/.SogouIME</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">获取通过网络获取时间的状态: adb shell settings get global auto_time. 返回:</span></span><ul><li><span class="name"><span class="innerContentContainer">1为允许、0为不允许</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">更改通过网络获取时间的状态，从1改为0: adb shell settings put global auto_time 0</span></span></li></ul></li></ul></li></ul>
  </body>
</html>