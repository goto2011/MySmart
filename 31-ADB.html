<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      body {font-family:'Helvetica Neue', Arial, sans-serif; color:#333; font-size:13px; line-height:17px;}
      body .name,body .note {white-space:pre-wrap;}
      body ul {list-style:disc; margin:0; padding:0;}
      body li {margin:4px 0 4px 20px; padding:0;}
      body>.name {font-size:16px; line-height:21px;}
      body>.note {font-size:13px; line-height:17px;}
      body>ul {margin-top:15px;}
      body .name.done {text-decoration:line-through; color:#999;}
      body .note {font-size:12px; color:#666;}
    </style>
  </head>
  <body>
    <span class="name">31-ADB</span><ul><li><span class="name"><b>adb shell dumpsys: 列出可被dump的系统状态条目. 支持一百三十多种. 多多使用.</b></span></li><li><span class="name">ADB连接管理</span><ul><li><span class="name">查看连接中的设备：adb devices.  返回设备ID可用于其它命令.</span></li><li><span class="name">等待设备连接上: adb wait-for-device  --用于脚本</span></li><li><span class="name">指定设备安装: adb  -s [设备ID] install ...</span></li><li><span class="name">获取设备序列号：adb get-serialno</span></li><li><span class="name">获取设备状态: adb get-state </span><ul><li><span class="name">设备的状态有 3 钟，device&nbsp;,&nbsp;offline&nbsp;,&nbsp;unknown</span></li><li><span class="name">device：设备正常连接</span></li><li><span class="name">offline：连接出现异常，设备无响应</span></li><li><span class="name">unknown：没有连接设备</span></li></ul></li><li><span class="name">终止adb服务进程：adb kill-server</span></li><li><span class="name">重启adb服务进程：adb start-server</span></li><li><span class="name">查看ADB帮助：adb help</span></li><li><span class="name">将宿主机上的某个端口重定向到设备的某个端口:  db forward tcp:1314 tcp:8888</span></li><li><span class="name">无线连接 Android 设备</span><ul><li><span class="name">手机、PC处于相同的网络下，手机 root ，安装应用 adbWireless ，启动应用后点击界面中间的按钮</span></li><li><span class="name">运行 adb connect 192.168.1.102&nbsp;, 即可通过无线的方式连接手机，缺点是速度比较慢</span></li></ul></li><li><span class="name">重启机器：adb reboot</span></li><li><span class="name">重启到bootloader，即刷机模式：adb reboot bootloader</span></li><li><span class="name">重启到recovery，即恢复模式：adb reboot recovery</span></li></ul></li><li><span class="name">设备管理</span><ul><li><span class="name">获取prop值:  adb shell getprop ro.build.version.sdk</span></li><li><span class="name">获取屏幕状态:  adb shell dumpsys display | findstr DisplayDeviceInfo.  返回:</span><ul><li><span class="name">DisplayDeviceInfo{"内置屏幕": 1080 x 1920, 55.0 fps, density 480, 464.949 x 468.923 dpi...</span></li></ul></li><li><span class="name">获取设备分辨率:  adb shell wm size</span><ul><li><span class="name">Physical size: 1080x1920</span></li></ul></li><li><span class="name">获取设备电池状态: adb shell dumpsys battery / batterystats. 返回:</span><ul><li><span class="name">Current Battery Service state:</span></li><li><span class="name">AC powered: false</span></li><li><span class="name">USB powered: true</span></li><li><span class="name">Wireless powered: false</span></li><li><span class="name">status: 2 <span class="contentTag" title="Filter #电池状态">#<span class="contentTagText">电池状态</span><span class="contentTagNub"></span></span></span></li><li><span class="name">health: 2</span></li><li><span class="name">present: true</span></li><li><span class="name">level: 34 <span class="contentTag" title="Filter #电量">#<span class="contentTagText">电量</span><span class="contentTagNub"></span></span></span></li><li><span class="name">scale: 100</span></li><li><span class="name">voltage: 3848</span></li><li><span class="name">current now: -427943</span></li><li><span class="name">temperature: 280 <span class="contentTag" title="Filter #电池温度">#<span class="contentTagText">电池温度</span><span class="contentTagNub"></span></span></span></li><li><span class="name">technology: Li-ion</span></li></ul></li><li><span class="name">获取MAC地址：adb shell cat /sys/class/net/wlan0/address</span></li><li><span class="name">获取CPU序列号：adb shell cat /proc/cpuinfo</span></li><li><span class="name">获取wifi状态: adb shell dumpsys wifi. 可以获取到当前连接的wifi名、搜索到的wifi列表、wifi强度等</span></li><li><span class="name">查看wifi密码：adb shell cat /data/misc/wifi/*.conf</span></li><li><span class="name">获取电源管理状态: adb shell dumpsys power. 返回:</span><ul><li><span class="name">可以获取到是否处于锁屏状态：mWakefulness=Asleep或者mScreenOn=false</span></li><li><span class="name">亮度值：mScreenBrightness=255</span></li><li><span class="name">屏幕休眠时间：Screen off timeout: 60000 ms</span></li><li><span class="name">屏幕分辨率：mDisplayWidth=1440，mDisplayHeight=2560</span></li></ul></li><li><span class="name">获取位置状态: adb shell dumpsys location</span></li><li><span class="name">获取电话状态: adb shell dumpsys telephony.registry. 返回:</span><ul><li><span class="name">mCallState值为0，表示待机状态、1表示来电未接听状态、2表示电话占线状态</span></li><li><span class="name">mCallForwarding=false <span class="contentTag" title="Filter #是否启用呼叫转移">#<span class="contentTagText">是否启用呼叫转移</span><span class="contentTagNub"></span></span></span></li><li><span class="name">mDataConnectionState=2 #0：无数据连接 1：正在创建数据连接 2：已连接</span></li><li><span class="name">mDataConnectionPossible=true  <span class="contentTag" title="Filter #是否有数据连接">#<span class="contentTagText">是否有数据连接</span><span class="contentTagNub"></span></span></span></li><li><span class="name">mDataConnectionApn=   <span class="contentTag" title="Filter #APN名称">#<span class="contentTagText">APN名称</span><span class="contentTagNub"></span></span></span></li></ul></li><li><span class="name">获取设备名称：adb shell cat /system/build.prop</span></li><li><span class="name">获取CPU信息:  adb shell dumpsys cpuinfo</span></li><li><span class="name">获取账号状态: adb shell dumpsys account</span></li><li><span class="name">获取亮度是否为自动获取: adb shell settings get system screen_brightness_mode</span></li><li><span class="name">获取当前亮度值: adb shell settings get system screen_brightness</span></li><li><span class="name">更改亮度值（亮度值在0—255之间）: adb shell settings put system screen_brightness 150</span></li><li><span class="name">获取屏幕休眠时间: adb shell settings get system screen_off_timeout</span></li><li><span class="name">更改休眠时间，10分钟: adb shell settings put system screen_off_timeout 600000</span></li></ul></li><li><span class="name">Log和debug管理</span><ul><li><span class="name">抓log：adb logcat</span></li><li><span class="name">抓指定关键字log: adb logcat | findstr "***"</span></li><li><span class="name">清除log缓存：adb logcat -c</span></li><li><span class="name">查看bug报告：adb bugreport</span></li><li><span class="name">跑monkey：adb shell monkey -v -p <a class="contentLink" target="_blank" rel="noreferrer" href="http://your.package.name">your.package.name</a> 500</span></li><li><span class="name"><b>模拟按键事件</b>:  adb shell input keyevent KEYCODE_HOME</span><ul><li><span class="name">事件在 KeyEvent.java 中定义</span></li><li><span class="name">public static final int KEYCODE_HOME = 3;</span></li><li><span class="name">因此可以将命令中的&nbsp;KEYCODE_HOME&nbsp;替换为&nbsp;3</span></li></ul></li><li><span class="name">模拟触摸事件:  adb shell input tap 500 500</span></li><li><span class="name">模拟滑动事件:  adb shell input swipe 900 500 100 500</span></li><li><span class="name">模拟长按事件: adb shell input swipe 500 500 501 501 2000</span></li><li><span class="name">截图命令:  adb shell screencap -p /sdcard/screen.png</span></li><li><span class="name">新增的录制命令:  adb shell screenrecord sdcard/record.mp4</span></li><li><span class="name">发送文本内容(不能发中文):  adb shell input text test123456</span></li><li><span class="name">settings 命令</span><ul><li><span class="name">从代码中查看该key值是在android.provider.Settings中定义了。</span></li><li><span class="name">以及获取、修改wifi状态（wifi_on）、飞行模式（airlpane_mode_on）等，这里也是appium中getNetworkConnection获得设备网络状态的方法。</span></li></ul></li></ul></li><li><span class="name">内存管理</span><ul><li><span class="name">查看设备cpu和内存占用情况：adb shell top</span></li><li><span class="name">查看占用内存前6的app：adb shell top -m 6</span></li><li><span class="name">刷新一次内存信息，然后返回：adb shell top -n 1</span></li><li><span class="name">查询各进程内存使用情况：adb shell procrank</span></li><li><span class="name">查看当前内存占用：adb shell cat /proc/meminfo</span></li><li><span class="name">查看IO内存分区：adb shell cat /proc/iomem</span></li><li><span class="name">获取内存状态:  adb shell dumpsys meminfo</span><ul><li><span class="name">要获取具体应用的内存信息，可加上包名: </span></li><li><span class="name">adb shell dumpsys meminfo PACKAGE_NAME</span></li></ul></li></ul></li><li><span class="name">分区和文件管理</span><ul><li><span class="name">将system分区重新挂载为可读写分区：adb remount</span></li><li><span class="name">从本地复制文件到设备：adb push &lt;local&gt; &lt;remote&gt;</span></li><li><span class="name">从设备复制文件到本地：adb pull &lt;remote&gt;&nbsp; &lt;local&gt;</span></li><li><span class="name">查看文件内容：adb shell cat &lt;file&gt;</span></li></ul></li><li><span class="name">进程管理</span><ul><li><span class="name">查看进程列表：adb shell ps</span></li><li><span class="name">查看指定进程状态：adb shell ps -x [PID]</span></li><li><span class="name">杀死一个进程：adb shell kill [pid]</span></li><li><span class="name">获取线程数的上限: adb shell cat /proc/sys/kernel/threads_max</span><ul><li><span class="name">FindX 是 57798</span></li></ul></li><li><span class="name">获取同时打开文件数上限: adb shell cat /proc/sys/fs/file_max</span><ul><li><span class="name">FindX 是732094</span></li></ul></li><li><span class="name">关闭 java 虚拟机: adb shell stop</span></li><li><span class="name">打开 java 虚拟机: adb shell start</span></li></ul></li><li><span class="name">APK管理</span><ul><li><span class="name">安装APK：adb install &lt;apkfile&gt;</span></li><li><span class="name">重新安装apk(保留数据和缓存)：adb install -r &lt;apkfile&gt;</span></li><li><span class="name">安装apk到sd卡：adb install -s &lt;apkfile&gt;</span></li><li><span class="name">卸载APK：adb uninstall &lt;package&gt;</span></li><li><span class="name">卸载app但保留数据和缓存文件：adb uninstall -k &lt;package&gt;</span></li><li><span class="name">获取package状态: adb shell dumpsys package,. 可指定包名.</span></li><li><span class="name">获取apk的packagename 和 classname:  aapt d badging &lt;apkfile&gt;</span></li><li><span class="name">列出安装在设备上的应用:  adb shell pm list package</span></li><li><span class="name">列出系统应用: adb shell pm list package -s</span></li><li><span class="name">列出第三方应用:  adb shell pm list package -3</span></li><li><span class="name">列出应用包名及对应的apk名及存放位置: adb shell pm list package -f</span></li><li><span class="name">列出应用包名及其安装来源:   adb shell pm list package -f -3 -i zhihu</span><ul><li><span class="name">返回: package:/data/app/com.zhihu.android-1.apk=com.zhihu.android  installer=com.xiaomi.market</span></li></ul></li><li><span class="name">列出对应包名的 .apk 位置: adb shell pm path com.tencent.mobileqq</span></li><li><span class="name">列出指定应用的 dump 信息: adb shell pm dump com.tencent.mobileqq</span></li><li><span class="name">安装应用(apk 文件在Android 设备中): pm install</span></li><li><span class="name">清除应用数据:  pm clear</span></li><li><span class="name">设置和获取应用安装位置: pm get-install-location</span><ul><li><span class="name">[0/auto]：默认为自动</span></li><li><span class="name">[1/internal]：默认为安装在手机内部</span></li><li><span class="name">[2/external]：默认安装在外部存储</span></li></ul></li></ul></li><li><span class="name">Activity和service管理</span><ul><li><span class="name">获取Activity信息: adb shell dumpsys activity</span></li><li><span class="name">获取当前界面的Activity信息：adb shell dumpsys activity top</span></li><li><span class="name">要获取当前界面的Activity：adb shell dumpsys activity top | findstr ACTIVITY</span></li><li><span class="name">启动应用：adb shell am start -n &lt;package_name&gt;/.&lt;activity_class_name&gt;</span></li><li><span class="name">启动一个 Activity: adb shell am start -n com.android.camera/.Camera</span></li><li><span class="name">先停止再启动:  adb shell am start -S com.android.camera/.Camera</span></li><li><span class="name">等待应用完成启动: adb shell am start -W com.android.camera/.Camera</span></li><li><span class="name">结束应用: am force-stop com.android.camera/.Camera</span></li><li><span class="name">获取当前界面的控件信息: adb shell uiautomator dump. 返回: </span><ul><li><span class="name">UI hierchary dumped to: /storage/emulated/legacy/window_dump.xml</span></li></ul></li><li><span class="name">列举所有services：adb shell service list</span></li><li><span class="name">启动一个服务: am startservice</span></li><li><span class="name">发送一个广播: am broadcast</span></li><li><span class="name">监控 crash 与 ANR:  am monitor </span></li><li><span class="name">默认打印出当前系统所有service信息，在后面可加上具体的服务名: adb shell dumpsys service</span></li><li><span class="name">列出当前运行的服务： adb shell dumpsys | findstr DUMP</span></li><li><span class="name">获取通知状态: adb shell dumpsys notification. 返回:</span><ul><li><span class="name">NotificationRecord(0x44217920: pkg=com.sohu.newsclient useron=0x7f0201b5 / com.tencent.news:drawable/icon</span></li><li><span class="name">pri=0 score=0</span></li><li><span class="name">contentIntent=PendingIntent{4294d748: PendingIntentRecord{44088e90 com.tencent.news startActivity}}</span></li><li><span class="name">deleteIntent=null</span></li><li><span class="name">tickerText=null</span></li><li><span class="name">contentView=android.widget.RemoteViews@441fc810</span></li><li><span class="name">defaults=0x00000001 flags=0x00000010</span></li><li><span class="name">sound=null</span></li><li><span class="name">vibrate=null</span></li><li><span class="name">led=0x00000000 onMs=0 offMs=0</span></li><li><span class="name">extras={</span><ul><li><span class="name">android.title=农业部:中国超级稻亩产超1吨</span></li><li><span class="name">android.subText=null</span></li><li><span class="name">android.showChronometer=false</span></li><li><span class="name">android.icon=2130837941</span></li><li><span class="name">android.text=农业部今日通报称,经专家测产,袁隆平领衔培育的中国“超级稻”亩产过千公斤,创造1026.7公斤新纪录。详情&gt;&gt;</span></li><li><span class="name">android.progress=0</span></li><li><span class="name">android.progressMax=0</span></li><li><span class="name">android.showWhen=true</span></li><li><span class="name">android.infoText=null</span></li><li><span class="name">android.progressIndeterminate=false</span></li><li><span class="name">android.scoreModified=false</span></li></ul></li><li><span class="name">}</span></li></ul></li><li><span class="name">获取provider状态:  adb shell dumpsys providers</span></li><li><span class="name">获取广播状态: adb shell dumpsys broadcasts</span></li><li><span class="name">获取进程状态: adb shell dumpsys processes</span></li><li><span class="name">获取提醒状态: adb shell dumpsys alarm</span></li><li><span class="name">获取intents消息: adb shell dunpsys intents</span></li></ul></li><li><span class="name">输入法和本地化</span><ul><li><span class="name">列出输入法: adb shell ime list -s, 返回:</span><ul><li><span class="name">com.google.android.inputmethod.pinyin/.PinyinIME</span></li><li><span class="name">com.baidu.input_mi/.ImeService</span></li></ul></li><li><span class="name">获取系统默认输入法: adb shell settings get secure default_input_method, 返回:</span><ul><li><span class="name">com.sohu.inputmethod.sogouoem/.SogouIME  默认搜狗输入法</span></li></ul></li><li><span class="name">选择输入法:  adb shell ime set com.baidu.input_mi/.ImeService</span></li><li><span class="name">默认为Appium使用中文输入时安装的输入法</span><ul><li><span class="name">adb shell settings get secure default_input_method io.appium.android.ime/.UnicodeIME</span></li></ul></li><li><span class="name">put命令更改默认输入法（将io.appium.android.ime/.UnicodeIME改为com.sohu.inputmethod.sogouoem/.SogouIME）</span><ul><li><span class="name">adb shell settings put secure default_input_method com.sohu.inputmethod.sogouoem/.SogouIME</span></li></ul></li><li><span class="name">获取通过网络获取时间的状态: adb shell settings get global auto_time. 返回:</span><ul><li><span class="name">1为允许、0为不允许</span></li></ul></li><li><span class="name">更改通过网络获取时间的状态，从1改为0: adb shell settings put global auto_time 0</span></li></ul></li></ul>
  </body>
</html>