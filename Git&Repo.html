<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
      body {font-family:'Helvetica Neue', Arial, sans-serif; color:#333; font-size:13px; line-height:17px;}
      body .name,body .note {white-space:pre-wrap;}
      body ul {list-style:disc; margin:0; padding:0;}
      body li {margin:4px 0 4px 20px; padding:0;}
      body>.name {font-size:16px; line-height:21px;}
      body>.note {font-size:13px; line-height:17px;}
      body>ul {margin-top:15px;}
      body .name.done {text-decoration:line-through; color:#999;}
      body .note {font-size:12px; color:#666;}
    </style>
  </head>
  <body>
    <span class="name"><span class="innerContentContainer"><b>Git&amp;Repo <span class="contentTag" title="Filter #Work">#<span class="contentTagText">Work</span><span class="contentTagNub"></span></span></b></span></span><ul><li><span class="name"><span class="innerContentContainer">Git原理</span></span><ul><li><span class="name"><span class="innerContentContainer">仓库就是长江黄河，长期存在，变化永无休止；</span></span></li><li><span class="name"><span class="innerContentContainer">分支就是长江黄河上的各个分支，分分合合；</span></span></li><li><span class="name"><span class="innerContentContainer">标签就是河流上的各个堤坝，一旦建成，就固定不动。基于标签下代码，基于标签出版本，基于标签拉分支。</span></span></li><li><span class="name"><span class="innerContentContainer">Git库: 就是根目录下的.git 目录，其中存放的是我们所提交的文档索引内容，Git 可基于文档索引内容对其所管理的文档进行内容追踪，从而实现文档的版本控制.</span></span></li><li><span class="name"><span class="innerContentContainer">Git库中由三部分组成</span></span><ul><li><span class="name"><span class="innerContentContainer">工作目录：用户本地的目录</span></span></li><li><span class="name"><span class="innerContentContainer">Index（索引）：将工作目录下所有文件（包含子目录）生成快照，存放到一个临时的存储区域.</span></span></li><li><span class="name"><span class="innerContentContainer">仓库：将索引通过commit命令提交至仓库中，每一次提交都意味着版本在进行一次更新。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">每次提交都会产生一个新的changeid, 并可在该changeid上打标签, 拉分支.</span></span></li><li><span class="name"><span class="innerContentContainer">几个特殊的tagid</span></span><ul><li><span class="name"><span class="innerContentContainer">dev表示发生在dev分支上的最后一次提交。</span></span></li><li><span class="name"><span class="innerContentContainer">dev^表示发生在dev分支上的倒数第二次提交。</span></span></li><li><span class="name"><span class="innerContentContainer">dev~2表示发生在dev分支上的倒数第三次提交。</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">查看提交记录: git log</span></span><ul><li><span class="name"><span class="innerContentContainer"><b>-p</b>: 显示最多信息, 包括代码变更</span></span></li><li><span class="name"><span class="innerContentContainer">日期范围： --after, --before</span></span><ul><li><span class="name"><span class="innerContentContainer">--before '10-01-2019'</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">指定文件： --pathname</span></span></li><li><span class="name"><span class="innerContentContainer">--stat -summary: 查看详细的统计数据</span></span></li><li><span class="name"><span class="innerContentContainer">--oneline: 一行显示</span></span></li><li><span class="name"><span class="innerContentContainer">-数字: 显示多少条</span></span></li><li><span class="name"><span class="innerContentContainer">--pretty=raw: 显示更多提示信息</span></span></li><li><span class="name"><span class="innerContentContainer">--graph: 显示提交线索, 主要用于父子提交</span></span></li><li><span class="name"><span class="innerContentContainer">--author ganduan: 指定提交人</span></span></li><li><span class="name"><span class="innerContentContainer">--grep ***: 指定关键字</span></span></li><li><span class="name"><span class="innerContentContainer">--date_order: 按照提交时间顺序. 不准, 推荐使用 greeit 网站.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">Git命令</span></span><ul><li><span class="name"><span class="innerContentContainer">git clone </span></span></li><li><span class="name"><span class="innerContentContainer">git checkout + 分支名</span></span></li><li><span class="name"><span class="innerContentContainer">拉代码到本地： git pull origin master (分别是服务器分支和本地分支)</span></span></li><li><span class="name"><span class="innerContentContainer">推代码到服务器： git push</span></span></li><li><span class="name"><span class="innerContentContainer">获取服务器分支名: git branch -r</span></span></li><li><span class="name"><span class="innerContentContainer">获取本地分支名: git branch, 在列出的分支中，若分支名前有*，即表示为当前分支。</span></span></li><li><span class="name"><span class="innerContentContainer">查看当前代码是从哪个分支上拉的. git branch -vv</span></span></li><li><span class="name"><span class="innerContentContainer">获取服务器仓名： git remote -v</span></span></li><li><span class="name"><span class="innerContentContainer">查看状态: git status</span></span><ul><li><span class="name"><span class="innerContentContainer">git add 前后建议各 git status 一次, 确认没有状态错误.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">添加文件: git add</span></span><ul><li><span class="name"><span class="innerContentContainer">git add . : 添加当前目录下的所有文件和子目录&nbsp;&nbsp;</span></span></li><li><span class="name"><span class="innerContentContainer">git add dirname: 添加一个目录</span></span></li><li><span class="name"><span class="innerContentContainer">git add *.java: 添加当前目录下的所有java文件</span></span></li><li><span class="name"><span class="innerContentContainer">git add -A: 当增, 改, 删同时存在时, 用这个命令.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">提交: git commit</span></span><ul><li><span class="name"><span class="innerContentContainer">直接调用git commit命令，会提示填写注释。无注释会提交失败.</span></span></li><li><span class="name"><span class="innerContentContainer">带注释提交是这样的: git commit -m "Initial commit of gittutor reposistory"&nbsp;</span></span></li><li><span class="name"><span class="innerContentContainer">每一次提交，git就会为全局代码建立一个唯一的commit标识代码.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">追加提交: git commit --amend</span></span><ul><li><span class="name"><span class="innerContentContainer">如果不想chang-id改变，需要在注释的最后一行注明：</span></span></li><li><span class="name"><span class="innerContentContainer">chang-id: </span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">回退所有本地修改: git reset --hard &lt;tagid&gt;</span></span><ul><li><span class="name"><span class="innerContentContainer">git reset HEAD^ 回退第一个记录</span></span></li><li><span class="name"><span class="innerContentContainer">git reset HEAD~2 回退第二个记录&nbsp;&nbsp;</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">回退指定文件的修改：  git checkout &lt;tagid&gt; &lt;filepath&gt;</span></span></li><li><span class="name"><span class="innerContentContainer">查看当前仓库地址（含仓库名）： git remote show origin</span></span></li><li><span class="name"><span class="innerContentContainer">rebase: 对提交记录进行增删改</span></span><ul><li><span class="name"><span class="innerContentContainer">仅针对本地分支</span></span></li><li><span class="name"><span class="innerContentContainer">合并最后三次提交</span></span><ul><li><span class="name"><span class="innerContentContainer">git rebase -i HEAD~3</span></span></li><li><span class="name"><span class="innerContentContainer">在弹出窗口中编辑指令</span></span><ul><li><span class="name"><span class="innerContentContainer">s: 和前一笔合并，且保留注释；</span></span></li><li><span class="name"><span class="innerContentContainer">f: 和前一笔合并，且不保留注释。</span></span></li><li><span class="name"><span class="innerContentContainer">d: 删除本笔提交。</span></span></li></ul></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">删除指定提交</span></span><ul><li><span class="name"><span class="innerContentContainer">找到它之前的提交, 执行命令: git rebase -i ID</span></span></li><li><span class="name"><span class="innerContentContainer">在弹出界面上, 将要删除的提交的id 前面的 pick 改为 drop, 然后保存退出.</span></span></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">git cherry-pick</span></span><ul><li><span class="name"><span class="innerContentContainer">将一个分支的部分提交, 移动到同主干的其它分支, 叫 cherry-pick.</span></span></li><li><span class="name"><span class="innerContentContainer">git cherry-pick &lt;changeid&gt;: 将指定changeid的提交, 合并到当前分支上.</span></span></li><li><span class="name"><span class="innerContentContainer">git cherry-pick &lt;changeid 1&gt; &lt;changeid 2&gt;: 合并指定的两个提交.</span></span></li><li><span class="name"><span class="innerContentContainer">git cherry-pick &lt;changeid 1&gt;..&lt;changeid 2&gt;: 合并从1到2之间的所有提交. 注意, changeid 1不在内.</span></span></li><li><span class="name"><span class="innerContentContainer">关键参数:</span></span><ul><li><span class="name"><span class="innerContentContainer">-x: 在提交信息的末尾追加一行(cherry picked from commit ...)，方便以后查到这个提交是如何产生的。</span></span></li><li><span class="name"><span class="innerContentContainer">-s: 在提交信息的末尾追加一行操作者的签名，表示是谁进行了这个操作。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">如果操作过程中发生代码冲突，Cherry pick 会停下来，让用户决定如何继续。</span></span><ul><li><span class="name"><span class="innerContentContainer">--continue</span></span><ul><li><span class="name"><span class="innerContentContainer">用户解决代码冲突后，第一步将修改的文件重新加入暂存区（git add .），第二步使用下面的命令，让 Cherry pick 过程继续执行。</span></span></li><li><span class="name"><span class="innerContentContainer">$ git cherry-pick --continue</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">--abort</span></span><ul><li><span class="name"><span class="innerContentContainer">发生代码冲突后，放弃合并，回到操作前的样子。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">--quit</span></span><ul><li><span class="name"><span class="innerContentContainer">发生代码冲突后，退出 Cherry pick，但是不回到操作前的样子。</span></span></li></ul></li></ul></li></ul></li><li><span class="name"><span class="innerContentContainer">Git其它命令</span></span><ul><li><span class="name"><span class="innerContentContainer">获取帮助: git help</span></span></li><li><span class="name"><span class="innerContentContainer">配置用户名: git config --global <a class="contentLink" target="_blank" rel="noreferrer" href="http://user.name">user.name</a> "userName"&nbsp;&nbsp;</span></span></li><li><span class="name"><span class="innerContentContainer">配置email: git config --global user.email&nbsp;you@yourdomain</span></span></li><li><span class="name"><span class="innerContentContainer">初始化本地库: git init</span></span><ul><li><span class="name"><span class="innerContentContainer">此时, 系统会自动创建一个名为“master”的分支。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">创建本地分支 work. --强烈建议。 </span></span><ul><li><span class="name"><span class="innerContentContainer">git branch work</span></span></li><li><span class="name"><span class="innerContentContainer">git checkout work</span></span></li><li><span class="name"><span class="innerContentContainer">或者合并成一步： git branch -b work</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">查看当前在哪个分支上: cat .git/HEAD.  --返回本地分支，没用。</span></span></li><li><span class="name"><span class="innerContentContainer">删除分支: git branch -D 分支名</span></span></li><li><span class="name"><span class="innerContentContainer">比较两个分支上的文件的区别: git diff master 分支名（比较主分支和另一个分支的区别）</span></span></li><li><span class="name"><span class="innerContentContainer">查看当前分支的操作记录: git whatchanged</span></span></li><li><span class="name"><span class="innerContentContainer">删除文件: git rm</span></span><ul><li><span class="name"><span class="innerContentContainer">git rm abc.java  : 删除当前目录的指定文件</span></span></li><li><span class="name"><span class="innerContentContainer">git rm -r *: 删除当前目录下的所有文件和子目录</span></span></li><li><span class="name"><span class="innerContentContainer">git rm --ached  adb.java:  删除指定文件，但只删除index中的文件记录；将已经git add的文件remove到cache中,这样commit的时候不会提交这个文件, 适用于一下子添加了很多文件, 却又想排除其中个别几个文件的情况.&nbsp;&nbsp;</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">查看指定版本的修改记录: git show + changeid</span></span><ul><li><span class="name"><span class="innerContentContainer">查看指定标签的修改记录: git show tagName</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">打标签: git tag "...",  可以用任意字符串.</span></span></li><li><span class="name"><span class="innerContentContainer">把服务器上下载下来的代码和本地代码合并, 或本地分支合并: git merge dev</span></span></li><li><span class="name"><span class="innerContentContainer">查看当前的git库中有哪些文件: git-ls-files</span></span></li><li><span class="name"><span class="innerContentContainer">本地代码更新到服务器端代码库上: git push origin&nbsp;, origin&nbsp;是服务器端代码库名.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">Repo常用命令</span></span><ul><li><span class="name"><span class="innerContentContainer">repo是git管理工具, google为Android设计.</span></span></li><li><span class="name"><span class="innerContentContainer">repo init: 初始化</span></span></li><li><span class="name"><span class="innerContentContainer">repo sync</span></span><ul><li><span class="name"><span class="innerContentContainer">什么参数都不加, 意思是下载或刷新所有仓</span></span></li><li><span class="name"><span class="innerContentContainer">参数为仓名, 即下载指定的仓. bootable/recovery</span></span></li><li><span class="name"><span class="innerContentContainer">在仓目录下使用 repo sync . , 意思是刷新指定仓.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">repo info + 仓名: 获取仓的属性</span></span></li><li><span class="name"><span class="innerContentContainer">repo start work . , 在当前仓创建本地分支, 名为 work.</span></span></li><li><span class="name"><span class="innerContentContainer">repo upload . , 将本地提交发布到master上.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">Gerrit检索</span></span><ul><li><span class="name"><span class="innerContentContainer">Gerrit是业界主流的基于git的web端的代码管理平台。检索语法如下：</span></span></li><li><span class="name"><span class="innerContentContainer">直接搜文件名，可获取涉及到的提交列表。</span></span></li><li><span class="name"><span class="innerContentContainer">project: 指定仓名</span></span></li><li><span class="name"><span class="innerContentContainer">branch: 指定分支</span></span></li><li><span class="name"><span class="innerContentContainer">message: 指定提交备注</span></span></li><li><span class="name"><span class="innerContentContainer">status: 指定提交状态，状态有 merged, open</span></span></li><li><span class="name"><span class="innerContentContainer">age: 1d, 表示1天内的提交，1w表示一周的。</span></span></li><li><span class="name"><span class="innerContentContainer">change: 指定change ID</span></span></li><li><span class="name"><span class="innerContentContainer">commit: 指定commit ID</span></span></li><li><span class="name"><span class="innerContentContainer">owner: 指定修改人</span></span><ul><li><span class="name"><span class="innerContentContainer">owner:self, 搜自己</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">ownerin: 指定修改人群组</span></span></li><li><span class="name"><span class="innerContentContainer">reviewer: 指定检视人</span></span></li><li><span class="name"><span class="innerContentContainer">reviewerin: 指定检视人群组</span></span></li><li><span class="name"><span class="innerContentContainer">topic: 指定提交标题(一般没有)</span></span></li><li><span class="name"><span class="innerContentContainer">多个条件用空格即可。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">解冲突</span></span><ul><li><span class="name"><span class="innerContentContainer">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span></span></li><li><span class="name"><span class="innerContentContainer">主干代码</span></span></li><li><span class="name"><span class="innerContentContainer">=======</span></span></li><li><span class="name"><span class="innerContentContainer">分支代码</span></span></li><li><span class="name"><span class="innerContentContainer">&gt;&gt;&gt;&gt;&gt;&gt;&gt; 分支名</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">diff文件的生成和使用</span></span><ul><li><span class="name"><span class="innerContentContainer">git status   // diff前先查看下是个好习惯</span></span></li><li><span class="name"><span class="innerContentContainer">git diff --full-index *** &gt; diff.txt,   其中 *** 包括如下几种:</span></span><ul><li><span class="name"><span class="innerContentContainer">什么也不填, 即表示所有.</span></span></li><li><span class="name"><span class="innerContentContainer">*.java,  所有的java 文件</span></span></li><li><span class="name"><span class="innerContentContainer">a.java,  指定文件名</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">使用diff:  git patch -p0 &lt; diff.txt</span></span></li><li><span class="name"><span class="innerContentContainer">两个文件之间产生diff: git diff file1 file2 &gt; diff.txt</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">文件忽略</span></span><ul><li><span class="name"><span class="innerContentContainer">工作目录中有一些文件是不希望接受Git 管理的，譬如程序编译时生成的中间文件等等。Git 提供了文档忽略机制，可以将不希望接受Git 管理的文件信息写到同一目录下的.gitignore 文件中。</span></span></li><li><span class="name"><span class="innerContentContainer">支持 *.lib 通配符, build/  文件路径 这两种形式.</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">问题: branch is published, but not merged </span></span><ul><li><span class="name"><span class="innerContentContainer">创建新的本地分支： repo start work2</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">问题: failed to push some refs to </span></span><ul><li><span class="name"><span class="innerContentContainer">一般原因是代码冲突。</span></span></li><li><span class="name"><span class="innerContentContainer">直接 git rebase, 将本地分支更新到本地。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">问题: repo start 本地分支后，本地修改的代码丢失</span></span><ul><li><span class="name"><span class="innerContentContainer">git reflog: 查看被删除的提交id</span></span></li><li><span class="name"><span class="innerContentContainer">git cheery-pick &lt;提交id&gt;, 即可合并到当前代码。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">问题: push后发现有代码冲突</span></span><ul><li><span class="name"><span class="innerContentContainer">常见的情况，因为远端新的提交防不胜防。</span></span></li><li><span class="name"><span class="innerContentContainer">git pull --rebase</span></span></li><li><span class="name"><span class="innerContentContainer">git status</span></span></li><li><span class="name"><span class="innerContentContainer">查看出现冲突的是哪个文件</span></span></li><li><span class="name"><span class="innerContentContainer">解冲突。</span></span></li><li><span class="name"><span class="innerContentContainer">git rebase --continue</span></span></li><li><span class="name"><span class="innerContentContainer">重新走提交流程。</span></span></li></ul></li><li><span class="name"><span class="innerContentContainer">问题: git commit --amend 追加错了提交</span></span><ul><li><span class="name"><span class="innerContentContainer">这是较常见的问题，因为上一次提交往往非如所愿。</span></span></li><li><span class="name"><span class="innerContentContainer">git reflog, 查看操作记录</span></span></li><li><span class="name"><span class="innerContentContainer">git reset --soft HEAD@{1} , 回退到第一步操作</span></span></li><li><span class="name"><span class="innerContentContainer">git status</span></span></li><li><span class="name"><span class="innerContentContainer">会发现状态回到 commit之前。</span></span></li></ul></li></ul>
  </body>
</html>